<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>é›»è©±è¾¨è­˜å·¥å…·</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(120deg, #f0f4ff, #ffffff);
      padding: 2em;
      color: #333;
    }
    h2 {
      color: #2c3e50;
    }
    textarea {
      width: 100%;
      height: 180px;
      margin-bottom: 1em;
      font-family: monospace;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fff;
    }
    button {
      padding: 10px 16px;
      margin-right: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #2980b9;
    }
    #resultTableWrapper {
      overflow-x: auto;
      max-height: 300px;
      border: 1px solid #ccc;
      background: #ffffff;
      padding: 1em;
      margin-top: 1.5em;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-family: monospace;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #ecf0f1;
      color: #2c3e50;
    }
    #stats {
      margin-top: 2em;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    #summary {
      flex: 1 1 300px;
    }
    #chartContainer {
      flex: 1 1 300px;
    }
    canvas {
      width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body>
  <h2>ğŸ“± é›»è©±è™Ÿç¢¼åœ‹å®¶è¾¨è­˜å·¥å…·</h2>
  <p>è«‹è²¼ä¸Šå«æœ‰æ‰‹æ©Ÿè™Ÿç¢¼çš„æ··äº‚è³‡æ–™ï¼š</p>
  <textarea id="input"></textarea>
  <button onclick="processPhones()">ğŸ” è¾¨è­˜é›»è©±</button>
  <button onclick="exportExcel()">ğŸ“¥ åŒ¯å‡º Excel</button>

  <div id="resultTableWrapper">
    <table id="resultTable" style="display: none;">
      <thead><tr><th>åœ‹ç¢¼</th><th>æ‰‹æ©Ÿé›»è©±</th><th>åœ‹å®¶åç¨±</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="stats">
    <div id="summary">
      <h3>ğŸ“Š çµ±è¨ˆè³‡è¨Š</h3>
      <p id="summaryText"></p>
    </div>
    <div id="chartContainer">
      <canvas id="countryChart"></canvas>
    </div>
  </div>

<script>
const countryMap = {
  '+1': 'ç¾åœ‹/åŠ æ‹¿å¤§', '+44': 'è‹±åœ‹', '+33': 'æ³•åœ‹', '+49': 'å¾·åœ‹', '+81': 'æ—¥æœ¬', '+82': 'éŸ“åœ‹',
  '+86': 'ä¸­åœ‹å¤§é™¸', '+852': 'é¦™æ¸¯', '+853': 'æ¾³é–€', '+886': 'å°ç£', '+60': 'é¦¬ä¾†è¥¿äº',
  '+65': 'æ–°åŠ å¡', '+61': 'æ¾³æ´²', '+62': 'å°å°¼', '+66': 'æ³°åœ‹', '+84': 'è¶Šå—', '+91': 'å°åº¦',
  '+7': 'ä¿„ç¾…æ–¯', '+34': 'è¥¿ç­ç‰™', '+39': 'ç¾©å¤§åˆ©', '+63': 'è²å¾‹è³“', '+95': 'ç·¬ç”¸', '+880': 'å­ŸåŠ æ‹‰',
  '+673': 'æ±¶èŠ', '+856': 'å¯®åœ‹', '+855': 'æŸ¬åŸ”å¯¨'
};

const blacklistPrefixes = ['012'];
let filteredResult = [];

function processPhones() {
  const raw = document.getElementById("input").value;
  const lines = raw.split(/[\n,;]+/).map(l => l.trim()).filter(Boolean);
  const cleaned = lines.map(p => p.replace(/[^+\d]/g, ''));

  filteredResult = [];
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = '';

  for (let num of cleaned) {
    if (blacklistPrefixes.some(pre => num.startsWith(pre))) continue;

    let matched = false;
    for (let code of Object.keys(countryMap).sort((a, b) => b.length - a.length)) {
      if (num.startsWith(code)) {
        const local = num.slice(code.length);
        if (/^\d{6,15}$/.test(local)) {
          filteredResult.push([code, local, countryMap[code]]);
          matched = true;
          break;
        }
      }
    }
    if (!matched && /^09\d{8}$/.test(num)) {
      filteredResult.push(['+886', num.slice(1), 'å°ç£']);
    }
  }

  filteredResult.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach(cell => {
      const td = document.createElement("td");
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  document.getElementById("resultTable").style.display = filteredResult.length ? '' : 'none';
  renderStats();
}

function renderStats() {
  const summary = document.getElementById("summaryText");
  const chart = document.getElementById("countryChart");
  chart.replaceWith(chart.cloneNode(true)); // Reset chart
  const newChart = document.getElementById("countryChart");

  const countByCountry = {};
  filteredResult.forEach(r => {
    const country = r[2];
    countByCountry[country] = (countByCountry[country] || 0) + 1;
  });
  const total = filteredResult.length;
  const countryCount = Object.keys(countByCountry).length;

  summary.textContent = `å…±è¾¨è­˜ ${total} ç­†é›»è©±ï¼Œæ¶µè“‹ ${countryCount} å€‹åœ‹å®¶ã€‚`;

  const chartData = {
    labels: Object.keys(countByCountry),
    datasets: [{
      label: 'é›»è©±æ•¸é‡',
      data: Object.values(countByCountry),
      backgroundColor: Object.keys(countByCountry).map(() => `hsl(${Math.random()*360}, 60%, 70%)`),
    }]
  };
  new Chart(newChart, {
    type: 'pie',
    data: chartData,
    options: {
      responsive: true,
      plugins: { legend: { position: 'right' } }
    }
  });
}

function exportExcel() {
  const rows = [["åœ‹ç¢¼", "æ‰‹æ©Ÿé›»è©±", "åœ‹å®¶åç¨±"], ...filteredResult];
  const ws = XLSX.utils.aoa_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "é›»è©±è¾¨è­˜çµæœ");
  XLSX.writeFile(wb, "é›»è©±è¾¨è­˜çµæœ.xlsx");
}
</script>
</body>
</html>
